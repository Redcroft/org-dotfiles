#+TITLE: Kanata Configuration
#+AUTHOR: Richard Redcroft
#+EMAIL: Richard@Redcroft.tech
#+OPTIONS: toc:nil num:nil
#+PROPERTY: Header-args :tangle-mode (identity #o444) :mkdirp yes
#+auto_tangle: t

#+begin_src lisp :tangle (if (string= system-name "red") "/sudo::/etc/kanata/config.kbd" "")
  (defcfg
      linux-dev "/dev/input/by-path/platform-i8042-serio-0-event-kbd"
    process-unmapped-keys yes)

  (defalias
      lwr (layer-toggle lower)
    qwr (layer-switch qwerty)
    dvk (layer-switch dvorak)
    cmk (layer-switch colemak)

    ma (tap-hold 200 200 a lmet)
    mr (tap-hold 200 200 r lalt)
    ms (tap-hold 200 200 s lsft)
    mt (tap-hold 200 200 t lctl)
    mn (tap-hold 200 200 n lctl)
    me (tap-hold 200 200 e lsft)
    mi (tap-hold 200 200 i lalt)
    mo (tap-hold 200 200 o lmet)
    mda (tap-hold 200 200 a lmet)
    mdo (tap-hold 200 200 o lalt)
    mde (tap-hold 200 200 e lsft)
    mdu (tap-hold 200 200 u lctl)
    mdh (tap-hold 200 200 h lctl)
    mdt (tap-hold 200 200 t lsft)
    mdn (tap-hold 200 200 n lalt)
    mds (tap-hold 200 200 s lmet)
    )

  (defsrc
      esc  f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 prnt ins del
      `    1  2  3  4  5  6  7  8  9  0   -   =   bspc
      tab  q  w  e  r  t  y  u  i  o  p   [   ]   ret
      caps a  s  d  f  g  h  j  k  l  ;   '   \
      lsft <  z  x  c  v  b  n  m  ,  .   /   rsft
      lctl lmet  lalt  spc  ralt  rctl  lft  up  down rght)


  (deflayer colemak
      esc  f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 @cmk @qwr del
      `    1  2  3  4  5  6  7  8  9  0   '   =   bspc
      tab  q  w  f  p  b  j  l  u  y  ;   [   ]   ret
      lctl a  r  s  t  g  m  n  e  i  o   -  \
      lsft z  x  c  d  v  z  k  h  ,  .  /  rsft
      lctl lmet  lalt  spc  @lwr  rctl  lft  up  down rght)


  (deflayer qwerty
      esc  f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 @cmk @qwr del
      `    1  2  3  4  5  6  7  8  9  0   -   =   bspc
      tab  q  w  e  r  t  y  u  i  o  p   [   ]   ret
      lctl a  s  d  f  g  h  j  k  l  ;   '   \
      lsft \  z  x  c  v  b  n  m  ,  .   /   rsft
      lctl lmet  lalt  spc  @lwr  rctl  lft  up  down rght)

  (deflayer dvorak
      esc  f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 @cmk @qwr del
      `    1  2  3  4  5  6  7  8  9  0   [   ]   bspc
      tab  '  ,  .  p  y  f  g  c  r  l   /   =   ret
      lctl a  o  e  u  i  d  h  t  n  s   -   \
      lsft \  ;  q  j  k  x  b  m  w  v   z   rsft
      lctl lmet  lalt  spc  @lwr  rctl  lft  up  down rght)

  (deflayer lower
      _    _    _    _    _  _  _  _  _  _  _   _   _   _    _    _
      _    @cmk @qwr @dvk _  _  _  _  _  _  _   _   _   _
      _    _    _    _    _  _  _  _  _  _  _   _   _   _
      _    _    _    _    _  _  _  _  _  _  _   _   _
      _    _    _    _    _  _  _  _  _  _  _   _   _
      _    _    _    _    _  _  _  _  _  _)
#+end_src

#+begin_src lisp :tangle (if (string= system-name "poseidon") "/sudo::/etc/kanata/config.kbd" "")
  (defcfg
      linux-dev ( /dev/input/by-id/usb-hfd.cn_USB_DEVICE-event-kbd
                  /dev/input/by-id/usb-HS6209_USB_Dongle_No.161-0047-5-event-kbd
                  )
    process-unmapped-keys yes)

  (defalias
      lwr (layer-toggle lower)
    qwr (layer-switch qwerty)
    dvk (layer-switch dvorak)
    cmk (layer-switch colemak))

  (defsrc
      esc  1  2  3  4  5  6  7  8  9  0   -   =   bspc
      tab  q  w  e  r  t  y  u  i  o  p   [   ]   \    del
      caps a  s  d  f  g  h  j  k  l  ;   '   ret      pgup
      lsft z  x  c  v  b  n  m  ,  .   /  rsft  up pgdn
      lctl lmet  lalt  spc  ralt  lft  down rght)

  (deflayer colemak
      esc  1  2  3  4  5  6  7  8  9  0   '   =   bspc
      tab  q  w  f  p  b  j  l  u  y  ;   [   ]   \    del
      lctl a  r  s  t  g  m  n  e  i   o   -  ret pgup
      lsft  x  c  d  v  z  k  h  ,  .  /  rsft up pgdn
      lctl lmet  lalt  spc  @lwr  lft  down rght)

  (deflayer qwerty
      esc  1  2  3  4  5  6  7  8  9  0   -   =   bspc
      tab  q  w  e  r  t  y  u  i  o  p   [   ]   \ del
      lctl a  s  d  f  g  h  j  k  l  ;   '   ret pgup
      lsft z  x  c  v  b  n  m  ,  .   /   rsft up pgdn
      lctl lmet  lalt  spc  @lwr  lft  down rght)

  (deflayer dvorak
      esc  1  2  3  4  5  6  7  8  9  0   [   ]   bspc
      tab  '  ,  .  p  y  f  g  c  r  l   /   =   \ del
      lctl a  o  e  u  i  d  h  t  n  s   -   ret pgup
      lsft ;  q  j  k  x  b  m  w  v   z   rsft up pgdn
      lctl lmet  lalt  spc  @lwr  lft  down rght)

  (deflayer lower
      _ f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 _
      _ @cmk @qwr @dvk _ _ _ _ _ _ _ _ _ _ _
      _ _ _ _ _ _ _ _ _ _ _ _ _ home
      _ _ _ _ _ _ _ _ _ _ _ _ _ end
      _ _ _ _ _ _ _ _)
#+end_src

#+begin_src lisp :tangle (if (string= system-name "heimdall") "/sudo::/etc/kanata/config.kbd" "")
  (defcfg
      linux-dev ( /dev/input/by-id/usb-ROYUAN_MonsGeek_2.4G_Wireless_Keyboard-event-kbd
                  /dev/input/by-id/usb-ROYUAN_MonsGeek_Keyboard-event-kbd
                  )
    process-unmapped-keys yes)

  (defalias
      lwr (layer-toggle lower)
    qwr (layer-switch qwerty)
    dvk (layer-switch dvorak)
    cmk (layer-switch colemak))

  (defsrc
      esc  1  2  3  4  5  6  7  8  9  0   -   =   bspc
      tab  q  w  e  r  t  y  u  i  o  p   [   ]   \
      caps a  s  d  f  g  h  j  k  l  ;   '   ret
      lsft z  x  c  v  b  n  m  ,  .   /  rsft
      lctl lmet  lalt  spc  ralt  del rctl)

  (deflayer colemak
      esc  1  2  3  4  5  6  7  8  9  0   '   =   bspc
      tab  q  w  f  p  b  j  l  u  y  ;   [   ]   \
      lctl a  r  s  t  g  m  n  e  i   o   -  ret
      lsft  x  c  d  v  z  k  h  ,  .  /  rsft
      @lwr lmet  lalt  spc  @lwr  del rctl)

  (deflayer qwerty
      esc  1  2  3  4  5  6  7  8  9  0   -   =   bspc
      tab  q  w  e  r  t  y  u  i  o  p   [   ]   \
      lctl a  s  d  f  g  h  j  k  l  ;   '   ret
      lsft z  x  c  v  b  n  m  ,  .   /   rsft
      @lwr lmet  lalt  spc  @lwr   del rctl)

  (deflayer dvorak
      esc  1  2  3  4  5  6  7  8  9  0   [   ]   bspc
      tab  '  ,  .  p  y  f  g  c  r  l   /   =   \
      lctl a  o  e  u  i  d  h  t  n  s   -   ret
      lsft ;  q  j  k  x  b  m  w  v   z   rsft
      @lwr  lmet lalt  spc  @lwr  del rctl)

  (deflayer lower
      _ f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 _
      _ _ up _ _ _ _ _ _ _ _ @cmk @qwr @dvk
      _ lft down rght _ _ _ lft down up rght _ _
      _ _ _ _ _ _ _ _ _ _ _ _
      _ _ _ _ _ pgdn pgup)
#+end_src

#+begin_src conf :tangle "/sudo::/etc/systemd/system/kanata.service"
  [Unit]
  Description=Kanata key remapping daemon
  Requires=local-fs.target
  After=local-fs.target

  [Service]
  Type=simple
  ExecStart=/usr/bin/kanata --cfg /etc/kanata/config.kbd

  [Install]
  WantedBy=sysinit.target
#+end_src
